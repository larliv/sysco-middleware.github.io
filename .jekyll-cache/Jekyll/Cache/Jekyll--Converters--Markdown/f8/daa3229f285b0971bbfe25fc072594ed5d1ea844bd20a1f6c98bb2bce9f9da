I"3<p>In this example we will create similar integration as in <a href="http://blog.sysco.no/osb/javascript/json/Retrieve-data-from-JSON-Using-JavaScript-Expressions-in-Oracle-Service-Bus-12c/">previous post</a> and only difference will be that both Request and Response will be in JSON format. So let‚Äôs call it a typed REST service. We will call a REST API with JSON data format (parameters as input) and as a Response we will get JSON also. So, if you have a requirement to work with some RESTful API that works only with JSON data format you can do it easy in the Service Bus 12.2.1.2 version without converting to XSD. All data mapping can be done in JavaScript activity. JavaScript is not limited to REST services. We can use JavaScript in any service.
Here we will call Weather data Rest API and retrieve some JSON information, and this is an example URL of this API:</p>

<p><a href="http://api.openweathermap.org/data/2.5/weather?q=Oslo&amp;appid=77d7bf10384d0beb90e02f4533c37535">http://api.openweathermap.org/data/2.5/weather?q=Oslo&amp;appid=77d7bf10384d0beb90e02f4533c37535</a></p>

<p>For more information on this API and how to use it you can visit <a href="http://openweathermap.org/current">Open Wheater site</a></p>

<h2 id="demo">Demo</h2>

<p>We will create:</p>
<ul>
  <li>REST Proxy Service ‚Äì where we will provide the parameter for the API call</li>
  <li>Pipeline</li>
  <li>REST Business service ‚Äì actual call to the REST API.</li>
</ul>

<p>This is how end result should look like and what folder structure is proposed.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/6_ProjectFolderStructure.jpg" alt="" /></p>

<p>As a first step after creating the project start by creating the necessary folders: Business, Proxy, Pipeline and Resources.</p>

<h2 id="rest-proxy-service">REST Proxy Service</h2>

<p>Right click in the Proxy Service lane and choose REST, or another option is to drag and drop the REST activity from the Service Bus Components from the right side of the jDeveloper.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/1_RESTAdapter.jpg" alt="" /></p>

<p>Now name your Proxy service which will be used for posting the JSON parameters as a request.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/1_RESTAdapter_2.jpg" alt="" /></p>

<p>In the next step in the Methods section click on the plus icon which represents ‚ÄúAdd a new REST method‚Äù.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/1_RESTAdapter_3.jpg" alt="" /></p>

<p>And a new window will show up for Request and Response methods. First, we will create a Request method by adding the parameters. In the section URI Parameters click on the green plus sign to add a new parameter and fill out the info as in the picture. You don‚Äôt need to fill the Description field, that was just a short explanation.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/1_RESTAdapter_4.jpg" alt="" /></p>

<p>Now do the same for second parameter:</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/1_RESTAdapter_5.jpg" alt="" /></p>

<p>Request tab should look like next picture:</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/1_RESTAdapter_6.jpg" alt="" /></p>

<p>For Response tab we can choose both JSON and XML as a payload options:</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/1_RESTAdapter_7.jpg" alt="" /></p>

<p>Click Finish and your Proxy service will be created and one important thing will be created also and that is WADL. If you created folder named Resources generated WADL will be stored in that folder automatically.</p>

<h2 id="pipeline-creation">Pipeline creation</h2>

<p>Next, we will create a pipeline by right clicking in the Pipeline/Split Joins lane.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/2_PipelineCreation_1.jpg" alt="" /></p>

<p>Now name your pipeline and choose the folder where you want it to be created.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/2_PipelineCreation.jpg" alt="" /></p>

<p>In the next wizard‚Äôs window we will do 3 steps:</p>
<ol>
  <li>Uncheck the ‚ÄúExpose as a Proxy Service‚Äù ‚Äì we already have a proxy service so we will not use this feature.</li>
  <li>Select REST as a Service Type and</li>
  <li>Click on the ‚ÄúBrowse WADLs‚Äù icon to select a WADL.</li>
</ol>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/2_PipelineCreation_2.jpg" alt="" /></p>

<p>Here you will select the WADL created from our Proxy service. And as a last step click finish and you Pipeline will be created. Now just what is left is to connect the Proxy Service with the Pipeline.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/2_PipelineCreation_3.jpg" alt="" /> <img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/2_PipelineCreation_4.jpg" alt="" /></p>

<h2 id="rest-business-service">REST Business Service</h2>

<p>Next is to set REST Business Service which will do the call to the Weather REST API. Right click in the External Services lane and choose REST again. Name your Business Service and click Next.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/3_RestBusinessService_1.jpg" alt="" /></p>

<p>In next window we have 3 steps to do:</p>
<ol>
  <li>Add Base URI from the Weather API we will use: <a href="http://api.openweathermap.org/data">http://api.openweathermap.org/data</a></li>
  <li>Then you need to add and create a REST resource by clicking the green plus icon in the Resources section.</li>
  <li>In Relative path add: 2.5/weather ‚Äì and you can see the full path and double check that it‚Äôs ok.</li>
</ol>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/3_RestBusinessService.jpg" alt="" /></p>

<p>Next step is to add a REST method by clicking the green plus icon in the Methods section.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/3_RestBusinessService_0.jpg" alt="" /></p>

<p>For Request do next:</p>
<ol>
  <li>Name your method.</li>
  <li>Select the HTTP verb as GET.</li>
  <li>Repeat the steps for parameters as in the creation of Proxy Service.</li>
</ol>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/3_RestBusinessService_2.jpg" alt="" /></p>

<p>Response tab can look like this using both JSON and XML. Click Finish.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/3_RestBusinessService_3.jpg" alt="" /></p>

<p>Final version of the REST Business service and how it should look like. Also Design view where you connect Business service with Pipeline.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/3_RestBusinessService_4.jpg" alt="" /></p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/4_DesignView.jpg" alt="" /></p>

<h2 id="pipeline-implementation-of-the-rest-call">Pipeline implementation of the REST call</h2>

<p>Now we will implement the logic behind the REST API call in the pipeline. So, do a double click to open the pipeline. This is the image you should have once inside the pipeline. First thing to do is to click on the Routing and in the bottom in Routing Properties change the Operation to ‚ÄúGetWeatherData‚Äù in our case which we created in Business service.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/5_PipelineImplementation_1.jpg" alt="" /></p>

<p>To call a REST service with parameters we have to use a Query parameters inside the transport request element of the call towards our Weather Data API. So, we need to add them to the <strong>$outbound</strong> variable. This is the same way how we receive the query parameters from <strong>$inbound</strong> variable in the request. We will do that by drag/dropping the <strong>Insert activity</strong> from the Components section on the right side into the Request Action lane.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/5_PipelineImplementation_2.jpg" alt="" /></p>

<p>Set the Insert Properties like this:
Value:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;http:query-parameters&gt;</span>
    <span class="nt">&lt;http:parameter</span> <span class="na">name=</span><span class="s">"q"</span> <span class="na">value=</span><span class="s">"{$inbound/ctx:transport/ctx:request/http:query-parameters/http:parameter[@name ='cityName']/@value}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;http:parameter</span> <span class="na">name=</span><span class="s">"appid"</span> <span class="na">value=</span><span class="s">"{$inbound/ctx:transport/ctx:request/http:query-parameters/http:parameter[@name ='appID']/@value}"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/http:query-parameters&gt;</span>
</code></pre></div></div>

<p>Position: as first child of
Location: select outbound variable from the drop down and add expression for the specific element in this case we need:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./ctx:transport/ctx:request
</code></pre></div></div>

<p>This is all we need to call and get the Weather data and get a JSON Response back from the API. Now we can deploy and test the integration.</p>

<h2 id="testing">Testing</h2>

<p>Log to your service bus console and find the deployed project. We can test this in two ways using a ‚ÄúTest Console‚Äù. We can do it from the Proxy service directly but for Debugging and detailed view of the execution flow we will use Pipeline.</p>

<p>So, expand your Pipeline folder and click on the pipeline name to open it. When it‚Äôs opened click on the green play button on the right side of the screen inside the pipeline window.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/8_Testing.jpg" alt="" /></p>

<p>In the Test Console fill the necessary fields for testing and just click <strong>Execute</strong>.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/8_Testing_2.jpg" alt="" /></p>

<p>Now you should get the results:</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/8_Testing_3.jpg" alt="" /></p>

<p>Next what we can try and test is to extract some of the data from this JSON response and create a small XML for example. This will be done by adding the JavaScript activity in Response Activity line inside the Pipeline.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/9_JSON_JavaScript_XML_0.jpg" alt="" /></p>

<p>Now we need to populate the JavaScript Value.</p>

<p>And you can use this code for creating new variable in JavaScript activity.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>process.XMLResponse = 
'<span class="nt">&lt;weather-data&gt;</span>\n'+
  '\t<span class="nt">&lt;temperature&gt;</span>' + process.body.main.temp + '<span class="nt">&lt;/temperature&gt;</span>\n'+
  '\t<span class="nt">&lt;main&gt;</span>' + process.body.weather[0].main + '<span class="nt">&lt;/main&gt;</span>\n'+
  '\t<span class="nt">&lt;description&gt;</span>' + process.body.weather[0].description + '<span class="nt">&lt;/description&gt;</span>\n'+
'<span class="nt">&lt;/weather-data&gt;</span>'
</code></pre></div></div>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/9_JSON_JavaScript_XML.jpg" alt="" /></p>

<p>Click ok, save your work in the pipeline and redeploy the integration so we can test it again.</p>

<p>Just repeat the same steps from the first test and go to the Invocation trace section and expand the <strong>$outbound</strong> and our <strong>$XMLResponse</strong> variable.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/8_Testing_4.jpg" alt="" /></p>

<p>In the <strong>$outbound</strong> variable we can see the <code class="highlighter-rouge">&lt;query-parameters&gt;</code> element with our parameters values towards the Weather API.</p>

<p>And <strong>$body</strong> variable is clean JSON data without any conversions.</p>

<p><img src="/images/2019-02-17-Call-REST-API-in-Service-Bus-12.2.1.2-JSON-Request-Response/8_Testing_5.jpg" alt="" /></p>
:ET