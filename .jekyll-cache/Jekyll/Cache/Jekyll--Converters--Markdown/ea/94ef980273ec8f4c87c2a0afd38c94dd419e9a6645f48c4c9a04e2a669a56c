I"s<h1 id="motivation-and-target-audience">Motivation and target audience</h1>

<p>Very often when we are creating tests in <a href="https://www.soapui.org/">SoapUI</a> where we end up writing a lot of <a href="http://groovy-lang.org/">Groovy</a> code to add extra flexibility to our tests, create central or shared assertions, load files and data from disk or simply add extra level of reusability to our tests. So this article is specially targeted towards API testers working with <a href="https://www.soapui.org/">SoapUI</a> tool by <a href="https://smartbear.com/">SmartBear</a> enabling them to reuse their <a href="http://groovy-lang.org/">Groovy</a> code in various projects without resolving to, developers hated, copy-paste technique.</p>

<h1 id="introduction">Introduction</h1>

<p>Although <a href="https://www.soapui.org/">SoapUI</a> is a nice API testing tool, that has a quite extensive <a href="http://groovy-lang.org/">Groovy</a> scripting support, it is not essentially designed to be used as a platform that facilities code development. Rather as a declarative environment that enables test engineers to declare <a href="https://www.soapui.org/docs/functional-testing/structuring-and-running-tests.html#1-Test-Structure">Test Cases</a> and assertions quickly. However resolving to scripting capabilities is very often inevitable, when we have to load test data from database, CSV files, etc. without resolving to the paid version of <a href="https://www.soapui.org/">SoapUI</a>. In a multi project environment, in such cases, very often engineers had to resolve to copy+past technique when they wan to apply the same <a href="http://groovy-lang.org/">Groovy</a> code on different <a href="https://www.soapui.org/">SoapUI</a> projects. One way to work around this problem is to write the shared code into form of <a href="https://en.wikipedia.org/wiki/JAR_(file_format)">JAR</a> library that can then be imported in different project. However this can be very impractical and demanding if our code is referencing specific <a href="https://www.soapui.org/">SoapUI</a> features or session information. So here we will see how to create shared code in a more <a href="https://www.soapui.org/">SoapUI</a> native way.</p>

<h1 id="developing-shared-groovy-libraries">Developing shared Groovy Libraries</h1>

<p>Process of developing shared <a href="https://www.soapui.org/">SoapUI</a> libraries can be divided into following steps:</p>

<ol>
  <li>Creating shared project with common functionality,</li>
  <li>Creating <a href="http://groovy-lang.org/">Groovy</a> classes with library methods,</li>
  <li>Defining library loading code in project that is going to use shared library,</li>
  <li>Using shared library code in specific <a href="https://support.smartbear.com/readyapi/docs/soapui/steps/groovy.html">Groovy Test Step</a>.</li>
</ol>

<h2 id="shared-project">Shared Project</h2>

<p>First step in developing shared <a href="http://groovy-lang.org/">Groovy</a> script library in <a href="https://www.soapui.org/">SoapUI</a> is by creating an ordinary <a href="https://www.soapui.org/">SoapUI</a> project that will contain one or more <a href="https://www.soapui.org/docs/functional-testing/structuring-and-running-tests.html#1-Test-Structure">Test Suites</a> that will contain one or more <a href="https://www.soapui.org/docs/functional-testing/structuring-and-running-tests.html#1-Test-Structure">Test Cases</a> composed of <a href="https://support.smartbear.com/readyapi/docs/soapui/steps/groovy.html">Groovy Test Steps</a>.</p>

<p><img src="/images/2018-11-23-scriptlibrary-in-soapui/Shared_project.png" alt="Example creating shared project" /> Fig. 1. Example creating shared project</p>

<h2 id="library-groovy-classes">Library Groovy classes</h2>

<p>When we have defined <a href="https://support.smartbear.com/readyapi/docs/soapui/steps/groovy.html">Groovy Test Steps</a> within the <a href="https://www.soapui.org/">SoapUI</a> project that we wanted to share, we have to define a <a href="http://groovy-lang.org/">Groovy</a> class that will contain methods that we want to reuse. We define one class for each <a href="https://support.smartbear.com/readyapi/docs/soapui/steps/groovy.html">Groovy Test Step</a> that we want to share. Class has to have a constructor that accepts: <strong>log</strong>, <strong>context</strong> and <strong>testRunner</strong> parameters. This parameters are actually global objects defined by <a href="https://www.soapui.org/">SoapUI</a> and made available to each <a href="https://support.smartbear.com/readyapi/docs/soapui/steps/groovy.html">Groovy Test Step</a>.</p>

<p>En example of such a constructor can be seen here:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Common utility functions library
 */</span>
<span class="kd">class</span> <span class="nc">CommonUtils</span> <span class="o">{</span>

  <span class="c1">//Global objects</span>
  <span class="kt">def</span> <span class="n">log</span>
  <span class="kt">def</span> <span class="n">context</span>
  <span class="kt">def</span> <span class="n">testRunner</span>

  <span class="kt">def</span> <span class="nf">CommonUtils</span><span class="o">(</span><span class="n">log</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="n">testRunner</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">log</span> <span class="o">=</span> <span class="n">log</span>
      <span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span>
      <span class="k">this</span><span class="o">.</span><span class="na">testRunner</span> <span class="o">=</span> <span class="n">testRunner</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This constructor gets <a href="https://www.soapui.org/">SoapUI</a> global objects when initialised and used within another <a href="https://support.smartbear.com/readyapi/docs/soapui/steps/groovy.html">Groovy Test Step</a>.</p>

<p>Now we can define one or more reusable methods and finally we have to define initialisation block at <a href="https://support.smartbear.com/readyapi/docs/soapui/steps/groovy.html">Groovy Test Step</a> end. Like in this example:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CommonUtils</span> <span class="n">initObj</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s2">"CommonUtils"</span><span class="o">)</span>
<span class="k">if</span> <span class="o">(</span><span class="n">initObj</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">initObj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CommonUtils</span><span class="o">(</span><span class="n">log</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="n">context</span><span class="o">.</span><span class="na">getTestRunner</span><span class="o">())</span>
    <span class="n">context</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">initObj</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span> <span class="n">initObj</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This block of code first checks if the object has already been initialised to assure singleton within calling context, and if the object hasnâ€™t been initialised than object is created and registered as a property of the global <a href="https://www.soapui.org/">SoapUI</a> <strong>context</strong> object. <a href="https://www.soapui.org/">SoapUI</a> generates <strong>log</strong>, <strong>context</strong> and <strong>testRunner</strong> objects for each test run.</p>

<p>So complete <a href="https://support.smartbear.com/readyapi/docs/soapui/steps/groovy.html">Groovy Test Step</a> that contains reusable <a href="http://groovy-lang.org/">Groovy</a> class with public methods can look like this:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.zip.GZIPInputStream</span>

<span class="cm">/**
 * Common utility functions library
 */</span>
<span class="kd">class</span> <span class="nc">CommonUtils</span> <span class="o">{</span>

  <span class="c1">//Global objects</span>
  <span class="kt">def</span> <span class="n">log</span>
  <span class="kt">def</span> <span class="n">context</span>
  <span class="kt">def</span> <span class="n">testRunner</span>

  <span class="kt">def</span> <span class="nf">CommonUtils</span><span class="o">(</span><span class="n">log</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="n">testRunner</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">log</span> <span class="o">=</span> <span class="n">log</span>
      <span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span>
      <span class="k">this</span><span class="o">.</span><span class="na">testRunner</span> <span class="o">=</span> <span class="n">testRunner</span>
  <span class="o">}</span>

  <span class="cm">/**
   * Function that is decompressing compressed XML messages
   */</span>
  <span class="n">String</span> <span class="nf">unzip</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">raw</span><span class="o">,</span> <span class="n">String</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s2">"UTF-8"</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">raw</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="k">return</span> <span class="s2">""</span>

     <span class="n">String</span> <span class="n">asString</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">raw</span><span class="o">)</span>

    <span class="kt">def</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">asString</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="s2">"&lt;soap11:Envelope"</span><span class="o">)</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">asString</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span><span class="c1">//not zipped</span>
    <span class="o">}</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">asString</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="s2">"&lt;Envelope"</span><span class="o">)</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">asString</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span><span class="c1">//not zipped</span>
    <span class="o">}</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">asString</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="s2">"&lt;soapenv:Envelope"</span><span class="o">)</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">asString</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">idx</span><span class="o">);</span><span class="c1">//not zipped</span>
    <span class="o">}</span>

    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">raw</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>        
        <span class="k">if</span> <span class="o">(</span><span class="n">raw</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">==</span> <span class="mi">31</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">def</span> <span class="n">length</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="na">size</span><span class="o">()-</span><span class="mi">1</span>
            <span class="kt">def</span> <span class="n">messagePart</span> <span class="o">=</span> <span class="n">raw</span><span class="o">[</span><span class="n">i</span><span class="o">..</span><span class="na">length</span><span class="o">]</span>

            <span class="kt">def</span> <span class="n">inflaterStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GZIPInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">ByteArrayInputStream</span><span class="o">(</span><span class="n">messagePart</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">messagePart</span><span class="o">.</span><span class="na">size</span><span class="o">()])))</span>
                <span class="kt">def</span> <span class="n">uncompressedStr</span> <span class="o">=</span> <span class="n">inflaterStream</span><span class="o">.</span><span class="na">getText</span><span class="o">(</span><span class="n">encoding</span><span class="o">)</span>

            <span class="n">log</span><span class="o">.</span><span class="na">info</span> <span class="s2">"DEBUG: unzip message uncompressedStr=$uncompressedStr"</span>

            <span class="k">return</span> <span class="n">uncompressedStr</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="s2">"Error unzipping message"</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="cm">/* Initialisation block */</span>
<span class="n">CommonUtils</span> <span class="n">initObj</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s2">"CommonUtils"</span><span class="o">)</span>
<span class="k">if</span> <span class="o">(</span><span class="n">initObj</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">initObj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CommonUtils</span><span class="o">(</span><span class="n">log</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="n">context</span><span class="o">.</span><span class="na">getTestRunner</span><span class="o">())</span>
    <span class="n">context</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">initObj</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span> <span class="n">initObj</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="library-loading-code">Library loading code</h2>

<p>Now that we have defined the class and initialisation block, we need a code that will run that block of code from another <a href="https://www.soapui.org/">SoapUI</a> project, and thus load classes that current project will use. Current project shared library object loading block is best placed in its own disabled <a href="https://support.smartbear.com/readyapi/docs/soapui/steps/groovy.html">Groovy Test Step</a> that can be placed in specific <strong>Initialisation</strong> Test Case. This Test Case can contain initialisation code for both local shared library code and global one.</p>

<p>Example of this organisation structure for the <a href="https://www.soapui.org/">SoapUI</a> project can be seen on following screen shot:</p>

<p><img src="/images/2018-11-23-scriptlibrary-in-soapui/InitLib.png" alt="Structure of the SoapUI project that is using shared library" /> Fig. 2. Structure of the <a href="https://www.soapui.org/">SoapUI</a> project that is using shared library</p>

<p>The code in the InitLib <a href="https://support.smartbear.com/readyapi/docs/soapui/steps/groovy.html">Groovy Test Step</a> is first getting right <a href="https://www.soapui.org/getting-started/working-with-soapui/managing-workspaces.html">SoapUI Workspace</a> by using globally available <strong>testRunner</strong> object. From that <strong>workspace</strong> object, script is trying to get shared library <strong>project</strong> object. The code works differently when the script is invoked from within <a href="https://www.soapui.org/">SoapUI</a> GUI environment, or when the script is invoked from the command line, or when running on <a href="https://jenkins.io/">Jenkins</a> server without GUI.</p>

<p>After assuring that shared library project has been correctly opened (here again process is different when working within GUI or from command line), the script is executing shared library initialisation block (see <a href="#library-groovy-classes">above</a>) and thus effectively creating shared library class and storing reference to it as a property of the <strong>context</strong> object.</p>

<p>The whole library loading code is give here:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">com.eviware.soapui.impl.wsdl.WsdlProject</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span>

<span class="cm">/* LIBRARY INTIALIZATION BLOCK */</span>
<span class="kt">def</span> <span class="n">project</span> <span class="o">=</span> <span class="kc">null</span>
<span class="kt">def</span> <span class="n">workspace</span> <span class="o">=</span> <span class="n">testRunner</span><span class="o">.</span><span class="na">testCase</span><span class="o">.</span><span class="na">testSuite</span><span class="o">.</span><span class="na">project</span><span class="o">.</span><span class="na">getWorkspace</span><span class="o">();</span>

<span class="c1">//Defining initialization steps to run</span>
<span class="kt">def</span> <span class="n">scriptLibNames</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"ErrorHandling"</span><span class="o">,</span> <span class="s2">"CommonUtils"</span><span class="o">]</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">scriptLibrary</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;()</span>

<span class="c1">//if running Soapui</span>
<span class="k">if</span><span class="o">(</span><span class="n">workspace</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
  <span class="n">project</span> <span class="o">=</span> <span class="n">workspace</span><span class="o">.</span><span class="na">getProjectByName</span><span class="o">(</span><span class="s2">"ScriptLibrary"</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">//if running in Jenkins</span>
<span class="k">else</span><span class="o">{</span>
  <span class="n">project</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WsdlProject</span><span class="o">(</span><span class="s2">"src/test/soapui/EMIF-library.xml"</span><span class="o">);</span>
<span class="o">}</span>

<span class="k">if</span><span class="o">(!</span><span class="n">project</span><span class="o">.</span><span class="na">open</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">project</span><span class="o">.</span><span class="na">reload</span><span class="o">()</span>

    <span class="c1">//if running Soapui</span>
    <span class="k">if</span><span class="o">(</span><span class="n">workspace</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
          <span class="n">project</span> <span class="o">=</span> <span class="n">workspace</span><span class="o">.</span><span class="na">getProjectByName</span><span class="o">(</span><span class="s2">"ScriptLibrary"</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="c1">//if running in Jenkins</span>
    <span class="k">else</span><span class="o">{</span>
          <span class="n">project</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WsdlProject</span><span class="o">(</span><span class="s2">"src/test/soapui/EMIF-library.xml"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//make a connection to the ScriptLibrary project</span>
<span class="k">if</span><span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">open</span> <span class="o">&amp;&amp;</span> <span class="n">project</span><span class="o">.</span><span class="na">name</span> <span class="o">==</span> <span class="s2">"ScriptLibrary"</span> <span class="o">)</span> <span class="o">{</span>

  <span class="kt">def</span> <span class="n">lib</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="na">getTestSuiteByName</span><span class="o">(</span><span class="s2">"library"</span><span class="o">).</span><span class="na">getTestCaseByName</span><span class="o">(</span><span class="s2">"common"</span><span class="o">)</span>

  <span class="k">if</span><span class="o">(</span><span class="n">lib</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s2">"Could not locate ReusableScripts! "</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">else</span><span class="o">{</span>

      <span class="n">scriptLibNames</span><span class="o">.</span><span class="na">each</span><span class="o">()</span> <span class="o">{</span> <span class="n">stepName</span> <span class="o">-&gt;</span>
      <span class="n">testStep</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="na">getTestStepByName</span><span class="o">(</span><span class="n">stepName</span><span class="o">)</span>      
      <span class="n">testStep</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">testRunner</span><span class="o">,</span> <span class="n">context</span><span class="o">)</span>      
       <span class="n">scriptLibrary</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">stepName</span><span class="o">,</span> <span class="n">context</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="n">stepName</span><span class="o">))</span>
       <span class="c1">//log.warn "Putting ${stepName} with object" + context.getProperty(stepName)</span>
      <span class="o">}</span>
  <span class="o">}</span>   
<span class="o">}</span>
<span class="k">else</span><span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s2">"Could not find project 'ScriptLibrary' !"</span><span class="o">)</span>
<span class="o">}</span>

<span class="cm">/* Storing reference to map with all loaded obects as a property of Context object */</span>
<span class="n">scriptLibraryChk</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s2">"scriptLibrary"</span><span class="o">)</span>
<span class="c1">//log.info scriptLibraryChk</span>
<span class="k">if</span> <span class="o">(</span><span class="n">scriptLibraryChk</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">context</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s2">"scriptLibrary"</span><span class="o">,</span> <span class="n">scriptLibrary</span><span class="o">)</span>
    <span class="c1">//log.info scriptLibrary</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="using-shared-library">Using shared library</h2>

<p>Finally in our project specific <a href="https://support.smartbear.com/readyapi/docs/soapui/steps/groovy.html">Groovy Test Step</a> we can start using our shared library by invoking following code:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s2">"scriptLibrary"</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
        <span class="n">testRunner</span><span class="o">.</span><span class="na">testCase</span><span class="o">.</span><span class="na">testSuite</span><span class="o">.</span><span class="na">getTestCaseByName</span><span class="o">(</span><span class="s2">"Initialization"</span><span class="o">).</span><span class="na">getTestStepByName</span><span class="o">(</span><span class="s2">"InitLib"</span><span class="o">).</span><span class="na">run</span><span class="o">(</span><span class="n">testRunner</span><span class="o">,</span> <span class="n">context</span><span class="o">)</span>    

<span class="kt">def</span> <span class="n">commonUtils</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s2">"scriptLibrary"</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s2">"CommonUtils"</span><span class="o">)</span>

<span class="kt">def</span> <span class="n">originalResponse</span> <span class="o">=</span> <span class="n">commonUtils</span><span class="o">.</span><span class="na">unzip</span><span class="o">(</span><span class="n">testRunner</span><span class="o">.</span><span class="na">testCase</span><span class="o">.</span><span class="na">getTestStepByName</span><span class="o">(</span><span class="n">stepName</span><span class="o">).</span><span class="na">getTestRequest</span><span class="o">().</span><span class="na">messageExchange</span><span class="o">.</span><span class="na">rawResponseData</span><span class="o">)</span>
</code></pre></div></div>

<p>This code first checks if the library has been loaded already (to assure singleton within the calling context) and than it loads the objects by running shared library loading script that initialises all shared library objects and stores them in a map object that is available as a property of the <strong>context</strong> object.</p>

<h1 id="conclusion">Conclusion</h1>

<p>Unfortunately <a href="https://www.soapui.org/">SoapUI</a> <a href="http://groovy-lang.org/">Groovy</a> support does not allows for easy <a href="http://groovy-lang.org/">Groovy</a> code editing, debugging and not to say <a href="http://groovy-lang.org/">Groovy</a> library creation. Thus we have to stick to workarounds that are using <a href="http://groovy-lang.org/">Groovy</a> code to invoke other scripts that are residing in different projects within the same workspace. This workaround is not easy and straitforward to implement, but nevertheless it allows us to have better <a href="http://groovy-lang.org/">Groovy</a> script code reusability and thus less error prone code, with minimal duplication.</p>
:ET