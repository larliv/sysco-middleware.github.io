I"É<h1 id="introduction">Introduction</h1>

<p>This is a follow-up post to the presentation we held yesterday at Hashitalks 2020:</p>

<p><a href="https://www.youtube.com/watch?v=xV4JnJgOHXE">YouTube Stream</a></p>

<p><a href="https://www.slideshare.net/FranciscoArturoViver/a-consul-service-mesh-integration-case-study-with-presto">Slideshare</a></p>

<p>The main point being that we‚Äôre actually leveraging these technologies as part of a wider initiative to build a state-of-the-art data platform.</p>

<h1 id="1-presto">1. Presto</h1>

<p>Presto is a distributed SQL tool which has become a key element in our toolbox because of its flexibility and growing number of plugins.</p>

<p><img src="/images/2020-02-20-A-Consul-Service-Mesh-Integration-Case-Study-with-Presto/presto.png" alt="" /></p>

<h1 id="2-consul-connect">2. Consul Connect</h1>

<p>Consul Connect is the service-mesh implementation provided by Hashicorp. At its simplest, it allows you to easily secure communication between all services in your ecosystem by using sidecar proxies which handle any inbound / outbound connections, while the services themselves will only talk to their own proxy through the loopback interface.</p>

<p><img src="/images/2020-02-20-A-Consul-Service-Mesh-Integration-Case-Study-with-Presto/connectsidecar.png" alt="" /></p>

<p>When dealing with opinionated services or applications (meaning that they will impose an architectural burden on you), the traditional blueprint can be severely strained, for example because the coordinator will use proprietary methods to differentiate among its different workers / brokers, thus rendering the cluster unable to communicate internally through loopback.</p>

<p>There‚Äôs another option though called ‚ÄúConnect Native Integration‚Äù, which we ended up exploring and adopting when we found ourselves facing a similar challenge with Presto:</p>

<p><img src="/images/2020-02-20-A-Consul-Service-Mesh-Integration-Case-Study-with-Presto/consulconnect.png" alt="" /></p>

<p>In many cases, the features offered by this kind of ‚Äúopinionated‚Äù application, outweigh by far the architectural shortcomings; Kafka / Zookeper would be another good example of this.</p>

<p>So, native integration becomes a very viable option for keeping architectural integrity within your Control Plane while still leveraging such technologies as part of your ecosystem.</p>

<h1 id="3-connect-native-integrating-presto">3. Connect-Native integrating Presto</h1>

<p>Native integration is basically mutual TLS + an API Authorization call, so we decided to contribute some code to the Presto open-source distribution <a href="https://prestosql.io">prestosql.io</a>, in order to make the Certificate handling functionality pluggable as well.</p>

<p><img src="/images/2020-02-20-A-Consul-Service-Mesh-Integration-Case-Study-with-Presto/contrib.png" alt="" /></p>

<p>So, there‚Äôs an open pull-request towards the Presto master (with a quite good outlook) and a ConsulConnect plugin (which does the API call) we have also developed and should be the next merge request.</p>

<p>The resulting architecture is something we really like, because it is a clean and organized way to solve a very challenging problem; also, it works beautifully!!</p>

<p><img src="/images/2020-02-20-A-Consul-Service-Mesh-Integration-Case-Study-with-Presto/architecture.png" alt="" /></p>

<h1 id="4-key-takeaways">4. Key Takeaways</h1>

<p>All in all, we have learnt a lot of lessons throughout this journey, so these are our 3 main conclusions:</p>

<ul>
  <li>State-of-the-art should be ‚Äúsimple as that‚Äù</li>
  <li>Refactor to reduce, redesign to refine</li>
  <li>Fortune favors the bold</li>
</ul>

<p>All of the latter speak to the importance of simplicity and also the benefits of embracing a mindset which allows our tech initiatives to be iterated upon, improved and re-shaped while striving to deliver top quality &amp; value.</p>

<p>Thanks for reading!!</p>
:ET