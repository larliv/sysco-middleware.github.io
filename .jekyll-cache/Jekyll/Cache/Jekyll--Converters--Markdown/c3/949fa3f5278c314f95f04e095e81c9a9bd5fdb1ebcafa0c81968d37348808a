I"Ü<p>In BPM projects, Organizational Units (OU) describes the departments or offices into a company that are involved in a business process. These departments or user groups maybe are not in an ‚Äúofficial‚Äù organizational chart necessarily, but they have a meaning to the business process.</p>

<p>When a project is created using Oracle BPM Studio, there is a file called ‚Äúorganization.xml‚Äù that is created. This file contains the roles, organizational units, calendars and holidays.</p>

<p>![organization.xml][/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1157.png]</p>

<h2 id="case-study-assign-a-task-by-organizational-unit">Case Study: Assign a Task by Organizational Unit</h2>

<p>In business processes normally there are cases when you need to approve one task but only the participants related with a department, e.g.: If one vacation request must be approved by the department manager. If one is from a Marketing employee, the Marketing manager should approve that request.</p>

<h3 id="creating-the-process">Creating the Process</h3>

<ol>
  <li>We will create a BPM project with a process as simple as the following:</li>
</ol>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1209.png" alt="BPMN Project" /></p>

<ol>
  <li>Then we can define a Business Object (with or without a XML Schema) like this one:</li>
</ol>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1212.png" alt="Business Object" /></p>

<ol>
  <li>Implement a Human Task using the wizard:</li>
</ol>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1219-610x391.png" alt="Auto-generate UI" /></p>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1221-610x391.png" alt="Project created" /></p>

<p>We can run this process with ‚Äúweblogic‚Äù user as a participant in the ‚Äúapprover‚Äù role and test it.</p>

<h3 id="adding-users-and-organizational-units">Adding Users and Organizational Units</h3>

<p>After testing the process, we can add some users and OUs.</p>

<ol>
  <li>To create users, we can use the administration console from WebLogic or we can use WLST. Check this post from Edwin Biemond: <a href="http://biemond.blogspot.no/2010/01/creating-users-and-groups-in-weblogic.html">http://biemond.blogspot.no/2010/01/creating-users-and-groups-in-weblogic.html</a></li>
</ol>

<p>In this case, I have created these users:</p>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1229-610x422.png" alt="Users" /></p>

<p>And all these ones belong to the group ‚Äúapprovers‚Äù</p>

<ol>
  <li>Double click on ‚ÄúOrganization‚Äù into the BPM project. Create these Organizational Units:</li>
</ol>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1233-610x391.png" alt="Organization Units" /></p>

<ol>
  <li>Assign the WebLogic group to the BPM role:</li>
</ol>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1236-610x378.png" alt="Roles" /></p>

<p>We can test the process now. All the users should have access to one task until some user claims it.</p>

<p>But, if the requirement is ‚ÄúThe requests must be assigned to and approved by the Department Manger‚Äù we can use different approaches: Get the manager from a Business Rule task, from a Service, call a Business rule directly from the Human Task, we can use Parametric Roles, or use Organizational Units :D.</p>

<p>I think that when the requirement says ‚Äúby department‚Äù or ‚Äúby office‚Äù we should use Organization Units. Here is how to:</p>

<h3 id="using-organizational-units">Using Organizational Units</h3>

<ol>
  <li>Select which Organizational Unit must be related with the BPM project. When the OU is in the project, use the second option, if the OU is in BPM Workspace use the third one:</li>
</ol>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1249-610x157.png" alt="OU Mapping" /></p>

<p>We must check that all the users, groups and roles used in the assignments must be part of the Organizational Units under the selected root (including the root). If a participant is not included, the task will not appear on BPM Workspace.</p>

<ol>
  <li>Then, we should tell the process with which OU must work:</li>
</ol>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1255-610x457.png" alt="OU Data Association" /></p>

<p>But what if the ID attribute coming from the Database is not related with my Organizational Unit name? In these cases we can use a Domain Value Map. This artifact let us define a relation between different domains. With this is not necessary to create tables to map values, or create boiler-plate code e.g. if we have a code on SAP and another one on BPM, we can use a DVM to match them.</p>

<ol>
  <li>Create a DVM and add two columns ‚ÄúDB‚Äù and ‚ÄúBPM‚Äù</li>
</ol>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1309.png" alt="DVM" /></p>

<p>Once created we can add values:</p>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1312.png" alt="DVM Values - 1" /></p>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1314.png" alt="DVM Values - 2" /></p>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1310-610x385.png" alt="DVM Values - 3" /></p>

<ol>
  <li>We can use XPath functions to get values from DVM artifacts. Let‚Äôs edit the data mapping in the start event:</li>
</ol>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1335-610x457.png" alt="DVM Mapping" /></p>

<p>The function should have this parameters:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    dvm:lookupValue("dvm/Department.dvm", "DB", string(bpmn:getDataOutput('request')/ns:departmentId), "BPM", "ACME")
</code></pre></div></div>

<p><img src="/images/2014-05-15-how-to-use-organizational-units-oracle-bpm-11g/2014-05-15_1336-610x528.png" alt="DVM Function" /></p>

<p>Now we can deploy and test the task assignments. The task must be assigned only to the Department approver.</p>

<p>Source Code: <a href="https://github.com/jeqo/bpm_org_poc">https://github.com/jeqo/bpm_org_poc</a></p>
:ET